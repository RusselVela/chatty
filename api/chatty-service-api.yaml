openapi: 3.0.0
info:
  title: Russel Vela's Chatty service
  version: v1
  description: API to communicate in real time with peers
  contact:
    name: Russel Vela
    email: vela.russel@gmail.com
servers:
  - url: localhost/v1
tags:
  - name: Public
    description: public APIs
paths:
  /v1/chatty/signup:
    post:
      summary: Registers a new user
      description: Registers a new user
      operationId: public-post-signup
      tags:
        - Public
      requestBody:
        $ref: '#/components/requestBodies/SignUpRequest'
      responses:
        201:
          $ref: '#/components/responses/201SuccessfulSignUp'
        400:
          $ref: '#/components/responses/400FailedSignUp'
        500:
          $ref: '#/components/responses/500InternalServerError'
  /v1/chatty/token:
    post:
      summary: Returns a token
      description:  Returns a token to be used in further operations
      operationId: public-post-login
      tags:
        - Public
      requestBody:
        $ref: '#/components/requestBodies/LoginRequest'
      responses:
        200:
          $ref: '#/components/responses/200SuccessfulLogin'
        401:
          $ref: '#/components/responses/401FailedLogin'
        500:
          $ref: '#/components/responses/500InternalServerError'
  /v1/chatty/chats/ws:
    get:
      summary: Connects to Chatty to send and receive messages
      description: Connects to Chatty
      operationId: public-post-ws
      tags:
        - Public
      responses:
        200:
          $ref: '#/components/responses/200SuccessfulWsConnection'
        400:
          $ref: '#/components/responses/400FailedWsConnection'
        401:
          $ref: '#/components/responses/401UnauthorizedError'
        500:
          $ref: '#/components/responses/500InternalServerError'
      security:
        - jwtAuth: []
#  /v1/chatty/channels/subscribe:
components:
  requestBodies:
    SignUpRequest:
      description: The request to signup
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/SignUpSchema'
    LoginRequest:
      description: The request to login
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/LoginSchema'

  responses:
    201SuccessfulSignUp:
      description: Signup is successful
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/SuccessSignupSchema'
    400FailedSignUp:
      description: User not created due to client error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/FailedSchema'
    200SuccessfulLogin:
      description: Login is successful
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/SuccessLoginSchema'
    401FailedLogin:
      description: Failed login
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/FailedSchema'
    200SuccessfulWsConnection:
      description: Message sent successfully
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/SuccessWsConnectionSchema'
    400FailedWsConnection:
      description: Message not sent due to client error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/FailedSchema'
    401UnauthorizedError:
      description: JWT token is missing or invalid
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/UnauthorizedSchema'
    500InternalServerError:
      description: Internal Server Error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/InternalServerErrorSchema'

  schemas:
    SignUpSchema:
      allOf:
        - $ref: '#/components/schemas/LoginSchema'
    SuccessSignupSchema:
      type: object
      required:
        - ok
        - username
        - id
      properties:
        ok:
          type: boolean
        username:
          type: string
        id:
          type: string
    LoginSchema:
      type: object
      required:
        - username
        - password
      properties:
        username:
          type: string
        password:
          type: string
          format: password
    SuccessLoginSchema:
      type: object
      required:
        - ok
        - token
      properties:
        ok:
          type: boolean
        token:
          type: string
          format: password
    FailedSchema:
      type: object
      required:
        - ok
        - error
      properties:
        ok:
          type: boolean
        error:
          type: string
    SuccessWsConnectionSchema:
      type: object
      required:
        - ok
        - timestamp
      properties:
        ok:
          type: boolean
        timestamp:
          type: string
    UnauthorizedSchema:
      type: object
      required:
        - message
      properties:
        message:
          type: string
    InternalServerErrorSchema:
      type: object
      required:
        - error
      properties:
        error:
          type: string

  securitySchemes:
    jwtAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
